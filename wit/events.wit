package fractal:events@0.1.0;

interface emit {
    emit: func(event: domain-event) -> result<event-id, event-error>;

    record domain-event {
        event-type: string,
        payload: list<u8>,
        source-app: string,
    }

    type event-id = u64;

    record event-error {
        code: u32,
        message: string,
    }
}

interface schedule {
    schedule: func(task: scheduled-task) -> result<task-id, event-error>;
    cancel: func(id: task-id) -> result<_, event-error>;

    record scheduled-task {
        name: string,
        cron: option<string>,
        run-at: option<u64>,
        target-app: string,
        payload: list<u8>,
    }

    type task-id = u64;
}
